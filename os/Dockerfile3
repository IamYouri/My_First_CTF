FROM ubuntu:20.04

# Créer un utilisateur non-root
RUN useradd -ms /bin/bash ctfuser

# Mettre à jour et installer des paquets nécessaires
RUN apt-get update && apt-get install -y \
    sudo \
    openssh-server \
    netcat \
    && rm -rf /var/lib/apt/lists/*

# Configurer SSH
RUN mkdir /var/run/sshd
RUN echo 'ctfuser:password' | chpasswd
RUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config
RUN echo 'ctfuser ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
RUN echo 'AllowUsers ctfuser' >> /etc/ssh/sshd_config

# Copier les fichiers de challenge
COPY challenges  /home/ctfuser/challenge

# Changer les permissions
RUN chown -R ctfuser:ctfuser /home/ctfuser/challenge

# Exposer les ports nécessaires
EXPOSE 22 5000

# Démarrer les services nécessaires
CMD ["/usr/sbin/sshd", "-D"]
